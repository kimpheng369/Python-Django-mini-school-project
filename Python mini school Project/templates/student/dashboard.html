{% extends 'base.html' %}

{% block title %}My Dashboard - LMS{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="h2">My Dashboard</h1>
    <p class="lead text-muted">Welcome back, {{ user.first_name|default:user.username }}! Here is your academic summary.</p>
</div>
<div class="row g-4 mb-4">
    <div class="col-md-6 col-xl-4">
        <div class="card bg-primary text-white shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">Average Score</h5>
                {% if average_grade is not None %}
                    <p class="display-4 fw-bold">{{ average_grade|floatformat:1 }}%</p>
                {% else %}
                    <p class="h4">No grades yet</p>
                {% endif %}
                <p class="card-text">Across {{ graded_count }} graded item(s).</p>
            </div>
            <a href="{% url 'student_my_grades' %}" class="card-footer text-white stretched-link">
                View All Grades <i class="bi bi-arrow-right-circle"></i>
            </a>
        </div>
    </div>
    <div class="col-md-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">Enrolled Courses</h5>
                <p class="display-4 fw-bold">{{ enrollments.count }}</p>
                <p class="card-text">Keep up the great work!</p>
            </div>
            <a href="{% url 'student_course_list' %}" class="card-footer stretched-link">
                Browse More Courses <i class="bi bi-arrow-right-circle"></i>
            </a>
        </div>
    </div>
    <div class="col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header"><h5 class="mb-0">Recent Grades</h5></div>
            <ul class="list-group list-group-flush">
                {% for sub in recent_grades %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ sub.assignment.title|truncatechars:25 }}
                        <span class="badge {% if sub.grade >= 85 %}bg-success{% elif sub.grade >= 70 %}bg-primary{% elif sub.grade >= 50 %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ sub.grade }}%</span>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted">No recent grades to show.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<hr class="my-4">
<div class="row g-4">
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header">
                <h4><i class="bi bi-calendar-week"></i> My Weekly Schedule</h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>Day</th><th>Time</th><th>Course</th><th>Instructor</th></tr></thead>
                        <tbody>
                            {% for schedule in schedules %}
                            <tr>
                                <td><strong>{{ schedule.get_day_of_week_display }}</strong></td>
                                <td>{{ schedule.start_time|time:"g:i A" }} - {{ schedule.end_time|time:"g:i A" }}</td>
                                <td>{{ schedule.course.title }}</td>
                                <td>{{ schedule.course.instructor.get_full_name|default:"N/A" }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" class="text-center text-muted p-4">You have no scheduled classes.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <h3 class="mb-3">My Enrolled Courses</h3>
        <div class="row">
            {% for enrollment in enrollments %}
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ enrollment.course.title }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted"><i class="bi bi-person-video3"></i> Instructor: {{ enrollment.course.instructor.get_full_name|default:"TBD" }}</h6>
                        <div class="mt-auto pt-3">
                            <a href="{% url 'student_course_detail' enrollment.course.id %}" class="btn btn-primary w-100"><i class="bi bi-arrow-right-circle-fill"></i> Go to Course</a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="card text-center p-5">
                    <div class="card-body">
                        <i class="bi bi-journal-x fs-1 text-muted"></i>
                        <h3 class="card-title mt-3">You're Not Enrolled in Any Courses Yet</h3>
                        <p class="card-text text-muted">Start your learning journey by finding a course that's right for you.</p>
                        <a href="{% url 'student_course_list' %}" class="btn btn-primary mt-2"><i class="bi bi-journals"></i> Browse Courses Now</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h4><i class="bi bi-info-circle-fill"></i> Quick Info</h4>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">Welcome to your dashboard!</li>
                <li class="list-group-item">Check your schedule weekly.</li>
                <li class="list-group-item">Submit assignments on time.</li>
                <li class="list-group-item">Have a great semester!</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}